<!DOCTYPE html>
<meta charset="utf-8">
<body style="background-color:black;">
<svg width="1960" height="1960"></svg>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var svgContainer = d3.select("svg");

var offset_x = 500;
var offset_y = 200;
var centerGroup = svgContainer.append('g')
							  .attr('transform', 'translate(500,200)');

var citys = ["berlin", "buenos_aires", "havanna", "kapstadt", "reykjavik",
						"shanghai", "singapur", "sydney", "weimar"];

var lines; 
var cityGroup;

for (let index = 0, offset_x = 500, offset_y = 200; index < citys.length; index++, offset_x+=10) {
	
	var lines, cityGroup;

	d3.csv("data/" + citys[index] + "/daily.csv", function(data) {
		console.log(citys[index]);
		return {
			windSpeed : +data["Wind Speed daily mean [10 m above gnd]"],
			windDir: +data["Wind Direction daily mean [10 m above gnd]"],
			meanTempr: +data['Temperature daily mean [2 m above gnd]'],
			meanPreci: +data['Total Precipitation daily sum [sfc]']
		};
	}, function(procData) {	//draws lines and circles of the "sun"
		console.log(index);
		console.log(offset_x);
	
		cityGroup = centerGroup.append('g').attr('transform', 'translate(' + offset_x +','+ offset_y + ')');
		lines = cityGroup.append('g');			

		procData.forEach(generateLinesTemprclrs);
		overall_mean_temp = calculate_mean_temp(procData);
		overall_mean_preci = calculate_mean_preci(procData);

		var outer_ring_clr = cityGroup.append('circle')
								.attr('r', overall_mean_temp + overall_mean_preci*3)
								.style('fill', '#add8e6');

		var center_clr = cityGroup.append('circle')
								.attr('r', overall_mean_temp)
								.style('fill', '#ffd700');
		var center_text = cityGroup.append('text')
								.attr('text-anchor', 'middle')
								.attr('alignment-baseline', 'middle')
								.attr('fill', 'black')
								.text(function() {
								return 'Berlin';
								});
	});

	//offset_x += 10;
	//offset_y += 200;
	
}




function generateLinesTemprclrs(d){
  var line = lines.append('line')
					  .attr('x1', 0) // center circle outer ring
					  .attr('y1', 0)
					  .attr('x2', d.windSpeed*10) // line length?? connecting centers or what we can see?
					  .attr('y2', 0)
					  .attr('stroke', '#ffd700')
					  .attr('stroke-width', '1px')
					  .attr('transform', 'rotate('+ d.windDir +')');
  var low_temp_arc  = d3.arc()
                        .startAngle(0.5*Math.PI)
                        .endAngle(1.5*Math.PI)
                        .innerRadius(0)
                        .outerRadius(10);
  var high_temp_arc = d3.arc()
                        .startAngle(-0.5*Math.PI)
                        .endAngle(0.5*Math.PI)
                        .innerRadius(0)
                        .outerRadius(10);
  var one_tempr_clr = cityGroup.append('g')
                                 .attr('transform','rotate('+ d.windDir +')translate('+ d.windSpeed*10 +')rotate('+ -d.windDir +')');
  one_tempr_clr.append("path").attr("d", low_temp_arc)
						 .attr('fill', '#44a');
  one_tempr_clr.append("path").attr("d", high_temp_arc)
						 .attr('fill', '#a44');                            
  
  }


function get_arc_color(d){

}

function generateLines(d){
  var line = lines.append('line')
					  .attr('x1', 0) // center circle outer ring
					  .attr('y1', 0)
					  .attr('x2', d.windSpeed*10) // line length?? connecting centers or what we can see?
					  .attr('y2', 0)
					  .attr('stroke', '#ffd700')
					  .attr('stroke-width', '1px')
					  .attr('transform', 'rotate('+ d.windDir +')')
  }

function calculate_mean_temp(d){
	var temperatureMean = d3.mean(d,function(a) { return +a.meanTempr});
	return temperatureMean;
}

function calculate_mean_preci(d){
	var preciMean = d3.mean(d,function(a) { return +a.meanPreci});
	return preciMean;
}

function blackBodyColor(d)
{
		temp = d + 273.15;
    var x = temp / 1000.0;
    var x2 = x * x;
    var x3 = x2 * x;
    var x4 = x3 * x;
    var x5 = x4 * x;

    var R, G, B = 0;

    // red
    if (temp <= 6600){
			R = 1;
		}    
    else{
        R = 0.0002889 * x5 - 0.01258 * x4 + 0.2148 * x3 - 1.776 * x2 + 6.907 * x - 8.723;
		}
    // green
    if (temp <= 6600){
        G = -4.593e-05 * x5 + 0.001424 * x4 - 0.01489 * x3 + 0.0498 * x2 + 0.1669 * x - 0.1653;
		}
    else{
        G = -1.308e-07 * x5 + 1.745e-05 * x4 - 0.0009116 * x3 + 0.02348 * x2 - 0.3048 * x + 2.159;
		}
    // blue
    if (temp <= 2000){
			B = 0;
		}
    else if (temp < 6600){
        B = 1.764e-05 * x5 + 0.0003575 * x4 - 0.01554 * x3 + 0.1549 * x2 - 0.3682 * x + 0.2386;
		}
    else{
        B = 1;
		}
		var result = [R, G, B];
    return result;
}
/*
function calc_dayly_avgs(){
	d3.csv("hourly_test.csv", function(data) {
  	return {
  		temperature : +data["Temperature  [2 m above gnd]"],
  		precipitation : +data["Total Precipitation  [sfc]"],
  		sunDur : +data["Sunshine Sunshine Duration  [sfc]"],
  		day : +data["Day"]
  	};
	}, function(data) {

		var final = []
		var day = data[0].day;
		var j = 0;

		var temperature_sum, sun_dur_sum, precipitation_sum;

		data.forEach(function(d){
			
			console.log(d.day);
			console.log(day);


			//deklarieren
			if (d.day == day) {
				// addiere
				temperature_sum += d.temperature;
				sun_dur_sum += d.sunDur;
				precipitation_sum += d.precipitation;
				//console.log(d.temperature);

			}
			else{
				//teile, in arraya und 
				final[j] = [temperature_sum / 24, sun_dur_sum / 24, precipitation_sum / 24];		
					//console.log(final[j]);

				console.log(final[j]);

				temperature_sum = d.temperature;
				sun_dur_sum = d.sunDur;
				precipitation_sum = d.precipitation;			
				j = j + 1;
				day = d.day;
				console.log(day);				
			}
		})
	})
};

// var lowTempArcs = svgContainer.append('g')
// 							 .attr('transform', 'translate(150,50)');
// var highTempArcs = svgContainer.append('g')
// 							 .attr('transform', 'translate(150,50)');



// var low_temp_arc = d3.arc()
// 	.startAngle(0.5*Math.PI)
// 	.endAngle(1.5*Math.PI)
// 	.innerRadius(0)
// 	.outerRadius(10);
// var high_temp_arc = d3.arc()
// 	.startAngle(-0.5*Math.PI)
// 	.endAngle(0.5*Math.PI)
// 	.innerRadius(0)
// 	.outerRadius(10);

// lowTempArcs.append("path").attr("d", low_temp_arc)
// 						 .attr('fill', '#44a');
// highTempArcs.append("path").attr("d", high_temp_arc)
// 						 .attr('fill', '#a44');
*/

</script>
</body>
